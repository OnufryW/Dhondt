# Params:
# - vote_data: a "just votes" config, with an "id" column and per-party vote
# - seat_data: a table that contains columns "id" and "seats" (#seats)

IMPORT $vote_data WITH PREFIX v;
TRANSFORM vtable WITH $1 AS vid, $? FOR 2:;
IMPORT $seat_data WITH PREFIX s;
TRANSFORM stable WITH id AS id, seats AS seats;
JOIN stable INTO vtable ON id EQ vid AS table;
TRANSFORM table WITH
  id AS id,
  dhondt(seats, $?, 4:) FOR 4:;
AGGREGATE table WITH sum($?) FOR 2:;
PIVOT table WITH OLD_HEADERS_TO party;
TRANSFORM table WITH $1 AS party, $2 AS seats;
