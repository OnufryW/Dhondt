INPUT TABLES values;
AGGREGATE values TO totals 
    WITH sum(curr()) FOR [int($from):] AS currname() + "_total";
JOIN totals INTO values ON 1 EQ 1 AS joint;
# Now, the columns in the joint table are:
# - X aggregated columns called foo_total
# - Y = (int($from) - 1) non aggregated columns called bar
# - X aggregated columns called foo
# So, in particular, X = int((numcolumns() - (int($from) - 1)) / 2)
TRANSFORM joint TO percentages WITH
  curr() FOR [
    int((numcolumns() - (int($from) - 1)) / 2) + 1 : 
    int((numcolumns() + (int($from) - 1)) / 2) + 1],
  curr() / at(currname() + "_total") FOR [
    int((numcolumns() + (int($from) - 1)) / 2) + 1 : ]
    AS currname() + "_perc";
OUTPUT TABLES percentages;
