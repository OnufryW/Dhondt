INPUT TABLES votes;
TRANSFORM votes WITH teryt AS teryt, eligible_voters AS eligible,
                     voters_voting_through_right_to_vote AS right;
RUN FILE "../sejm_election_results/by_district.cfg" FROM votes INTO res;

TRANSFORM res TO pcztery WITH district AS district, eligible AS param;
RUN FILE "../distribute_seats/by_parameter.cfg" WITH PARAM method niemeyer
    FROM pcztery INTO pcztery;
TRANSFORM pcztery WITH id AS cid, seats AS cseats;

TRANSFORM res TO ppiec WITH district AS district, eligible + right AS param;
RUN FILE "../distribute_seats/by_parameter.cfg" WITH PARAM method niemeyer
    FROM ppiec INTO ppiec;
TRANSFORM ppiec WITH id AS pid, seats AS pseats;

JOIN pcztery INTO ppiec ON cid EQ pid WITH RAISE UNMATCHED KEYS AS final;
TRANSFORM final WITH cid AS id, cseats AS pcztery, pseats AS ppiec;
OUTPUT TABLES final;
