# Takes a table, assuming the it has a first column named teryt, and then
# a bunch of numeric columns. Aggregates (sums) the numeric columns by
# district.

# TODO:
# a) Have an aggregation called "all equal",
# b) Access the column type in aggregation functions.

INPUT TABLES table;
# CHECK table COLUMN 1 NAMED teryt TYPED string;
TRANSFORM table WITH
  if(len(teryt) = 5, "0" + teryt, teryt) AS teryt,
  curr() FOR 2:;

LOAD districts FROM "../district_definitions/prefixes.csv";
TRANSFORM districts WITH TERC AS TERC, at(2) AS district;

JOIN districts INTO table ON TERC PREFIX teryt AS jtable;
TRANSFORM jtable WITH district AS district, curr() FOR 4:;
AGGREGATE jtable BY district WITH 
  district AS district, 
  sum(curr()) FOR 2:;

OUTPUT TABLES jtable;
