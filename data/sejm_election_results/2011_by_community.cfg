# See README.md for usage.
# This is data about the Sejm election results in 2011, grouped by community,
# the format is standard for by-community election results, see the
# README.md file.
# Foreign votese are grouped together into one row with the community set
# to 'Zagranica'.

LOAD raw FROM 'raw/2011_by_community.csv';
TRANSFORM raw TO votes WITH
  if(len(teryt) = 6, "0" + teryt, teryt) AS teryt,
  curr() FOR 2:5,
  int(curr()) FOR 5:
;
TRANSFORM votes WITH
  teryt AS teryt,
  community_name AS community,
  county_name AS county,
  voivodship_name AS voivodship,
  number_of_commissions AS number_of_commissions,
  number_of_commissions AS number_of_considered_commissions,
  cards_given_out AS cards_received,
  eligible_voters AS eligible_voters,
  0 AS unused_cards,
  cards_given_out AS voters_who_received_cards_in_person,
  0 AS by_mail_packets_sent,
  cards_given_out AS voters_who_received_cards_in_total,
  0 AS voters_voting_through_intermediary,
  0 AS voters_voting_through_right_to_vote,
  0 AS by_mail_packets_received,
  0 AS by_mail_packets_without_declaration,
  0 AS by_mail_packets_with_unsigned_declaration,
  0 AS by_mail_packets_without_envelope,
  0 AS by_mail_packets_with_unsealed_envelope,
  0 AS by_mail_packets_in_urn,
  cards_given_out AS cards_retrieved_from_urn,
  0 AS cards_out_of_envelopes,
  cards_given_out - valid_cards AS invalid_cards,
  valid_cards AS valid_cards,
  valid_cards - valid_votes AS invalid_votes,
  0 AS invalid_too_many_xs,
  0 AS invalid_no_x,
  0 AS invalid_struck_list,
  valid_votes AS valid_votes_total,
  # Actual results
  at(10) AS Samoobrona,
  at(11) AS Korwin,
  at(12) AS PlatformaObywatelska,
  at(13) AS PolskaJestNajważniejsza,
  at(14) AS PartiaPracy,
  at(15) AS PolskieStronnictwoLudowe,
  at(16) AS Prawica,
  at(17) AS PrawoISprawiedliwość,
  at(18) AS RuchPalikota,
  at(19) AS SojuszLewicyDemokratycznej,
  at(20) AS MniejszośćNiemiecka
;

OUTPUT TABLES votes;
