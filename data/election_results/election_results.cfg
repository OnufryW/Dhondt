# votes should be in votes-only, by district format.
# seats should be in the district definitions format.

INPUT TABLES votes, seats;

TRANSFORM votes WITH at(1) AS vid, curr() FOR 2:;
TRANSFORM seats WITH id AS id, seats AS seats;
JOIN seats INTO votes ON id EQ vid AS table;
TRANSFORM table WITH
  id AS id,
  dhondt(seats, index(currname()), 4:) FOR 4:;
AGGREGATE table WITH sum(curr()) FOR 2:;
PIVOT table WITH OLD_HEADERS_TO party;
TRANSFORM table WITH at(1) AS party, at(2) AS seats;
OUTPUT TABLES table;

